import{c as ve}from"./IconPlus-B7SALRyD.js";import{d as me,u as fe,B as ge,c as Q,r as c,w as Z,o as be,a as n,b as l,t as f,j as w,e as p,v as S,F as k,f as x,x as ee,g as T,y as he,l as Y,h as o}from"./index-RJ6DD6zJ.js";import{_ as H}from"./lodash-G3svvU1B.js";import{s as u}from"./request-DGITvm3f.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ea=ve("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const ke=()=>u.get("/cbtumblebug/ns"),Ce=t=>u.get(`/cbtumblebug/ns/${t}/mci`),Ie=t=>u.get(`/cbtumblebug/ns/${t.nsId}/mci/${t.mciId}`),we=t=>u.get(`/cbtumblebug/ns/${t}/k8scluster`),Se=t=>u.get(`/catalog/software?name=${t}`),La=t=>u.get(`/catalog/software/${t}`),$a=t=>u.get(`/search/dockerhub/${t}`),Ra=t=>u.get(`/search/artifacthub/${t}`),Ve=t=>u.post("/applications/vm/deploy",t),ae=t=>u.post("/applications/action",t),xe=t=>u.post("/applications/k8s/deploy",t),Me=t=>u.get(`/applications/vm/check?namespace=${t.namespace}&mciId=${t.mciName}&vmId=${t.vmName}&catalogId=${t.catalogId}`),Ue=t=>u.get(`/applications/k8s/check?namespace=${t.namespace}&clusterName=${t.clusterName}&catalogId=${t.catalogId}`),Ta=t=>u.get(`/ape/log/${t}`);function Pa(t){return u.post("/catalog/software",t)}function Da(t){return u.put(`/catalog/software/${t.id}`,t)}function Fa(t){return u.delete(`/catalog/software/${t}`)}function Ha(){return u.get("/api/applications/status/groups")}function Ka(t){return u.post("/catalog/application/category",t)}function za(t){return u.post("/catalog/application/package",t)}function Ba(t){const C={target:t.target,applicationName:t.packageName};return u.post("/catalog/application/package/version",C)}function ja(t){return u.get(`/search/dockerhub/tag/${t.path}`)}function qa(t){return u.get(`/search/artifacthub/version/${t.kind}/${t.repository}/${t.packageName}`)}function Ya(t){return u.post("/catalog/docker/register",t)}function Oa(t){return u.post("/catalog/helm/register",t)}function Wa(t){return u.post("/catalog/rating/overall",t)}function Xa(t){return u.get(`/api/applications/integrated/deployment/${t}`)}function Ga(t){return u.get(`/catalog/selectbox/options?type=${t}`)}const Ae={class:"modal fade",id:"install-form",tabindex:"-1"},Ne={class:"modal-dialog modal-lg",role:"document"},_e={class:"modal-content"},Ee={class:"modal-header"},Le={class:"modal-title"},$e={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},Re={class:"mb-3"},Te={key:0,class:"text-muted"},Pe={key:1,class:"text-muted"},De=["value"],Fe={class:"mb-3"},He={key:0,class:"text-muted"},Ke={key:1,class:"text-muted"},ze=["value"],Be={value:"selectNsId"},je={class:"mb-3"},qe={key:0,class:"text-muted"},Ye={key:1,class:"text-muted"},Oe=["disabled"],We=["value"],Xe={class:"mb-3"},Ge=["disabled"],Je=["value"],Qe={key:0,class:"mt-2",style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Ze=["onClick"],ea={class:"mb-3"},aa={style:{display:"flex",gap:"10px"}},la={class:"form-check"},ta={class:"form-check"},sa={class:"mb-3"},na=["value"],oa={class:"mb-3"},ia={class:"mb-3"},ua={key:0,class:"text-muted"},ra={key:1,class:"text-muted"},ca=["value"],da={value:"selectNsId"},pa={class:"mb-3"},va={key:0,class:"text-muted"},ma={key:1,class:"text-muted"},fa=["disabled"],ga=["value"],ba={class:"mb-3"},ha=["value"],ya={key:0,class:"mb-3"},ka={class:"mb-2"},Ca={class:"form-check"},Ia={key:0,class:"d-flex justify-content-between"},wa={class:"modal-footer d-flex justify-content-between"},Sa=["disabled"],Va=["disabled"],xa=me({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(t){const C=fe(),O=ge(),K=t,d=Q(()=>K.title),W=c([]),V=c([]),P=c([]),M=c([]),N=c([]),R=c([]),r=c(""),i=c(""),h=c(""),y=c(""),v=c([]),g=c("Standalone"),m=c({}),_=c({}),D=c([]),U=c(""),I=c(""),F=c(""),A=c(!0);Z(r,async s=>{H.isEmpty(i.value)||(s==="VM"?(h.value="",y.value="",v.value=[],M.value=[],N.value=[],await B()):s==="K8S"&&(U.value="",await j()),I.value="",L())}),Z(g,()=>{g.value==="Standalone"?(v.value=[],M.value=[...N.value]):g.value==="Clustering"&&(v.value=[],M.value=[...N.value])}),be(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await z(),await le()})});const z=async()=>{r.value="VM",i.value="",h.value="",y.value="",v.value=[],N.value=[],g.value="Standalone",m.value={hpaEnabled:!1,hpaMinReplicas:1,hpaMaxReplicas:10,hpaCpuUtilization:60,hpaMemoryUtilization:80},_.value={ingressEnabled:!1,ingressHost:"",ingressPath:"/",ingressClass:"nginx",ingressTlsEnabled:!1,ingressTlsSecret:""},te(),se(),await ne()},le=async()=>{await Se("").then(({data:s})=>{R.value=s})},te=()=>{W.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},se=()=>{d.value==="Application Uninstallation"?A.value=!1:A.value=!0},ne=async()=>{await ke().then(async({data:s})=>{if(console.log("## data ### : ",s),V.value=s,V.value.length>0)if(!H.isEmpty(K.nsId))i.value=K.nsId;else if(H.isEmpty(O.getNsId()))i.value=V.value[0].name;else{const e=O.getNsId();V.value.find(b=>b.name===e)?i.value=e:i.value=V.value[0].name}H.isEmpty(i.value)||(r.value==="VM"?await B():r.value==="K8S"&&await j())})},B=async()=>{await Ce(i.value).then(async({data:s})=>{P.value=s,P.value.length>0?(h.value=P.value[0].name,await X()):h.value=""})},X=async()=>{const s={nsId:i.value,mciId:h.value};await Ie(s).then(({data:e})=>{N.value=e.vm,M.value=N.value.filter(a=>!v.value.includes(a.id)),y.value=""})},j=async()=>{await we(i.value).then(({data:s})=>{D.value=s,D.value.length>0?U.value=D.value[0].name:U.value=""})},q=async()=>{v.value=[],await B(),L()},oe=async()=>{v.value=[],await X(),L()},ie=async()=>{await j(),L()},L=()=>{d.value==="Application Installation"?A.value=!0:d.value==="Application Uninstallation"&&(A.value=!1)},ue=()=>{if(y.value!==""){if(g.value==="Standalone")v.value=[y.value];else if(g.value==="Clustering"&&!v.value.includes(y.value)){v.value.push(y.value);const s=M.value.findIndex(e=>e.id===y.value);s!==-1&&M.value.splice(s,1)}y.value="",L()}},re=s=>{const e=v.value[s];if(v.value.splice(s,1),g.value==="Clustering"){const a=N.value.find(b=>b.id===e);a&&M.value.push(a)}L()},ce=async()=>{let s={};if(r.value==="VM"){I.value.split(",").map(a=>a.toLowerCase().trim());let e={};if(d.value=="Application Installation"){const a=g.value==="Clustering"?`${I.value}-cluster`:`${I.value}-standalone`;e={namespace:i.value,mciId:h.value,vmIds:v.value,clusterName:a,catalogId:E.value,servicePort:F.value,username:"admin",deploymentType:r.value,vmDeploymentMode:g.value.toUpperCase()},s=await Ve(e)}else s=await ae(e);s.data?C.success("SUCCESS"):C.error("FAIL")}else if(r.value==="K8S"){I.value.split(",").map(a=>a.toLowerCase().trim());let e={namespace:i.value,clusterName:U.value,catalogId:E.value,servicePort:F.value,username:"",deploymentType:r.value,hpaEnabled:m.value.hpaEnabled,minReplicas:m.value.hpaMinReplicas,maxReplicas:m.value.hpaMaxReplicas,cpuThreshold:m.value.hpaCpuUtilization,memoryThreshold:m.value.hpaMemoryUtilization,ingressEnabled:_.value.ingressEnabled,ingressHost:_.value.ingressHost,ingressPath:_.value.ingressPath,ingressClass:_.value.ingressClass,ingressTlsEnabled:_.value.ingressTlsEnabled,ingressTlsSecret:_.value.ingressTlsSecret};d.value=="Application Installation"?s=await xe(e):s=await ae(e),s.data?C.success("SUCCESS"):C.error("FAIL")}},de=async()=>{r.value==="VM"||r.value==="K8S"?pe().then(s=>{let e=!0;if(s===null){C.error("Please select all items");return}else if(s===!1){let a="";r.value==="VM"?a="VM":r.value==="K8S"&&(a="CLUSTER");const b="Your selected "+a+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(b)}e&&(C.success("Please click RUN"),A.value=!1)}):C.error("Please Select Infra")},pe=async()=>{let s=!1;if(r.value==="VM"){if(i.value===""||h.value===""||v.value.length===0||E.value===0)return null;{const e={namespace:i.value,mciName:h.value,vmName:v.value[0],catalogId:E.value};await Me(e).then(({data:a})=>{s=a})}}else if(r.value==="K8S"){if(i.value===""||U.value===""||E.value===0){C.error("Please select all items");return}const e={namespace:i.value,clusterName:U.value,catalogId:E.value};await Ue(e).then(({data:a})=>{s=a})}return s},E=c(0),G=Q(()=>r.value==="VM"?R.value.filter(s=>s.packageInfo):r.value==="K8S"?R.value.filter(s=>s.helmChart):R.value),J=()=>{d.value==="Application Installation"&&(A.value=!0),R.value.forEach(s=>{if(I.value===s.name){E.value=s.id;return}})};return(s,e)=>(o(),n("div",Ae,[l("div",Ne,[l("div",_e,[l("div",Ee,[l("h5",Le,f(d.value),1),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:z})]),l("div",$e,[l("div",Re,[e[18]||(e[18]=l("label",{class:"form-label"},"Target Infra",-1)),d.value=="Application Installation"?(o(),n("p",Te," Select the Infra what is the Infra will be installed ")):d.value=="Application Uninstallation"?(o(),n("p",Pe," Select the Infra what is the Infra will be uninstalled ")):w("",!0),p(l("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a)},[(o(!0),n(k,null,x(W.value,a=>(o(),n("option",{value:a.value,key:a.value},f(a.value),9,De))),128))],512),[[S,r.value]])]),r.value=="VM"?(o(),n(k,{key:0},[l("div",Fe,[e[19]||(e[19]=l("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(o(),n("p",He," Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(o(),n("p",Ke," Select the namespace where the application will be uninstalled")):w("",!0),V.value.length>0?p((o(),n("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),onChange:q},[(o(!0),n(k,null,x(V.value,a=>(o(),n("option",{value:a.name,key:a.name},f(a.name),9,ze))),128))],544)),[[S,i.value]]):p((o(),n("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),onChange:q},[l("option",Be,f(i.value),1)],544)),[[S,i.value]])]),l("div",je,[e[20]||(e[20]=l("label",{class:"form-label"},"MCI Name",-1)),d.value=="Application Installation"?(o(),n("p",qe," Select the multi-cloud infrastructure information where the application will be deployed")):d.value=="Application Uninstallation"?(o(),n("p",Ye," Remove the application and associated resources from the multi-cloud infrastructure")):w("",!0),p(l("select",{class:"form-select",id:"mci-name",disabled:i.value=="","onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),onChange:oe},[(o(!0),n(k,null,x(P.value,a=>(o(),n("option",{value:a.id,key:a.name},f(a.name),9,We))),128))],40,Oe),[[S,h.value]])]),l("div",Xe,[e[22]||(e[22]=l("label",{class:"form-label"},"VM Name",-1)),e[23]||(e[23]=l("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),p(l("select",{class:"form-select",id:"mci-name",disabled:h.value=="","onUpdate:modelValue":e[4]||(e[4]=a=>y.value=a),onChange:ue},[e[21]||(e[21]=l("option",{value:""},"Select VM",-1)),(o(!0),n(k,null,x(M.value,a=>(o(),n("option",{value:a.id,key:a.name},f(a.name),9,Je))),128))],40,Ge),[[S,y.value]]),v.value.length>0?(o(),n("div",Qe,[(o(!0),n(k,null,x(v.value,(a,b)=>(o(),n("label",{key:b,class:"form-check-label",style:{border:"1px solid #000",padding:"5px","border-radius":"5px",cursor:"pointer"}},[Y(f(a)+" ",1),l("span",{onClick:$=>re(b),style:{"margin-left":"5px","font-weight":"bold"}},"X",8,Ze)]))),128))])):w("",!0)]),l("div",ea,[e[26]||(e[26]=l("label",{class:"form-label"},"Deployment Type",-1)),e[27]||(e[27]=l("p",{class:"text-muted"},"Select the deployment type",-1)),l("div",aa,[l("div",la,[p(l("input",{class:"form-check-input",type:"radio",id:"Standalone","onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),value:"Standalone"},null,512),[[ee,g.value]]),e[24]||(e[24]=l("label",{class:"form-check-label",for:"Standalone"},"Standalone",-1))]),l("div",ta,[p(l("input",{class:"form-check-input",type:"radio",id:"Clustering","onUpdate:modelValue":e[6]||(e[6]=a=>g.value=a),value:"Clustering"},null,512),[[ee,g.value]]),e[25]||(e[25]=l("label",{class:"form-check-label",for:"Clustering"},"Clustering",-1))])])]),l("div",sa,[e[28]||(e[28]=l("label",{class:"form-label"},"Application",-1)),e[29]||(e[29]=l("p",{class:"text-muted"},"Select the application",-1)),p(l("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=a=>I.value=a),onChange:J},[(o(!0),n(k,null,x(G.value,(a,b)=>{var $;return o(),n("option",{key:b,value:a.name}," ["+f(a.name)+"] "+f((($=a.packageInfo)==null?void 0:$.packageVersion)||"latest"),9,na)}),128))],544),[[S,I.value]])]),l("div",oa,[e[30]||(e[30]=l("label",{class:"form-label"},"Port",-1)),e[31]||(e[31]=l("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),p(l("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[8]||(e[8]=a=>F.value=a)},null,512),[[T,F.value]])])],64)):r.value=="K8S"?(o(),n(k,{key:1},[l("div",ia,[e[32]||(e[32]=l("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(o(),n("p",ua,"Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(o(),n("p",ra,"Select the namespace where the application will be uninstalled")):w("",!0),V.value.length>0?p((o(),n("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[9]||(e[9]=a=>i.value=a),onChange:ie},[(o(!0),n(k,null,x(V.value,a=>(o(),n("option",{value:a.name,key:a.name},f(a.name),9,ca))),128))],544)),[[S,i.value]]):p((o(),n("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[10]||(e[10]=a=>i.value=a),onChange:q},[l("option",da,f(i.value),1)],544)),[[S,i.value]])]),l("div",pa,[e[33]||(e[33]=l("label",{class:"form-label"},"ClusterName",-1)),d.value=="Application Installation"?(o(),n("p",va,"Select the name of the cluster where the application will be deployed")):d.value=="Application Uninstallation"?(o(),n("p",ma,"Remove the application and associated resources from the multi-cloud infrastructure")):w("",!0),p(l("select",{class:"form-select",id:"mci-name",disabled:i.value=="","onUpdate:modelValue":e[11]||(e[11]=a=>U.value=a)},[(o(!0),n(k,null,x(D.value,a=>(o(),n("option",{value:a.id,key:a.name},f(a.name),9,ga))),128))],8,fa),[[S,U.value]])]),l("div",ba,[e[34]||(e[34]=l("label",{class:"form-label"},"Helm chart",-1)),e[35]||(e[35]=l("p",{class:"text-muted"},"Select the application",-1)),p(l("select",{class:"form-select","onUpdate:modelValue":e[12]||(e[12]=a=>I.value=a),onChange:J},[(o(!0),n(k,null,x(G.value,(a,b)=>{var $;return o(),n("option",{key:b,value:a.name}," ["+f(a.name)+"] "+f((($=a.helmChart)==null?void 0:$.chartVersion)||"latest"),9,ha)}),128))],544),[[S,I.value]])]),d.value=="Application Installation"?(o(),n("div",ya,[e[43]||(e[43]=l("label",{class:"form-label"},"HPA Configuration",-1)),l("div",ka,[l("div",Ca,[p(l("input",{class:"form-check-input",type:"checkbox",id:"hpaEnabled","onUpdate:modelValue":e[13]||(e[13]=a=>m.value.hpaEnabled=a)},null,512),[[he,m.value.hpaEnabled]]),e[36]||(e[36]=l("label",{class:"form-check-label",for:"hpaEnabled"}," Enable HPA (Horizontal Pod Autoscaler) ",-1))])]),m.value.hpaEnabled?(o(),n("div",Ia,[l("div",null,[e[37]||(e[37]=l("label",{class:"form-label required"}," minReplicas ",-1)),p(l("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[14]||(e[14]=a=>m.value.hpaMinReplicas=a)},null,512),[[T,m.value.hpaMinReplicas]])]),l("div",null,[e[38]||(e[38]=l("label",{class:"form-label required"}," maxReplicas ",-1)),p(l("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[15]||(e[15]=a=>m.value.hpaMaxReplicas=a)},null,512),[[T,m.value.hpaMaxReplicas]])]),l("div",null,[e[39]||(e[39]=l("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),p(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[16]||(e[16]=a=>m.value.hpaCpuUtilization=a)},null,512),[[T,m.value.hpaCpuUtilization]]),e[40]||(e[40]=Y(" % "))]),l("div",null,[e[41]||(e[41]=l("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),p(l("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[17]||(e[17]=a=>m.value.hpaMemoryUtilization=a)},null,512),[[T,m.value.hpaMemoryUtilization]]),e[42]||(e[42]=Y(" % "))])])):w("",!0)])):w("",!0)],64)):w("",!0)]),l("div",wa,[l("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:z}," Cancel "),l("div",null,[d.value=="Application Installation"?(o(),n("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:de,disabled:!A.value}," Spec Check ",8,Sa)):w("",!0),l("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:ce,disabled:A.value}," Deploy ",8,Va)])])])])]))}}),Ja=ye(xa,[["__scopeId","data-v-ef42f606"]]);export{Ja as A,Ea as I,Xa as a,Ha as b,Ka as c,Pa as d,La as e,za as f,Ga as g,Ba as h,Fa as i,ja as j,qa as k,Se as l,$a as m,Ra as n,Ya as o,Oa as p,Ta as q,ae as r,Wa as s,Da as u};
