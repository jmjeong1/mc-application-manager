import{c as me}from"./IconPlus-CVN_oQZM.js";import{d as fe,u as ge,B as be,c as Z,r as v,w as ee,o as he,a as n,b as a,t as g,j as h,e as r,v as x,F as I,f as U,x as le,g as M,y as Y,l as O,h as o}from"./index-BHPkE3P8.js";import{_ as F}from"./lodash-kZgskVh2.js";import{s as u}from"./request-DJv9NrOs.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var zl=me("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const ke=()=>u.get("/cbtumblebug/ns"),Ce=t=>u.get(`/cbtumblebug/ns/${t}/mci`),Ie=t=>u.get(`/cbtumblebug/ns/${t.nsId}/mci/${t.mciId}`),we=t=>u.get(`/cbtumblebug/ns/${t}/k8scluster`),Se=t=>u.get(`/catalog/software?name=${t}`),Bl=t=>u.get(`/catalog/software/${t}`),jl=t=>u.get(`/search/dockerhub/${t}`),ql=t=>u.get(`/search/artifacthub/${t}`),xe=t=>u.post("/applications/vm/deploy",t),ae=t=>u.post("/applications/action",t),Ve=t=>u.post("/applications/k8s/deploy",t),Ue=t=>u.get(`/applications/vm/check?namespace=${t.namespace}&mciId=${t.mciName}&vmId=${t.vmName}&catalogId=${t.catalogId}`),Me=t=>u.get(`/applications/k8s/check?namespace=${t.namespace}&clusterName=${t.clusterName}&catalogId=${t.catalogId}`),Yl=t=>u.get(`/ape/log/${t}`);function Ol(t){return u.post("/catalog/software",t)}function Wl(t){return u.put(`/catalog/software/${t.id}`,t)}function Xl(t){return u.delete(`/catalog/software/${t}`)}function Gl(){return u.get("/api/applications/status/groups")}function Jl(t){return u.post("/catalog/application/category",t)}function Ql(t){return u.post("/catalog/application/package",t)}function Zl(t){const w={target:t.target,applicationName:t.packageName};return u.post("/catalog/application/package/version",w)}function ea(t){return u.get(`/search/dockerhub/tag/${t.path}`)}function la(t){return u.get(`/search/artifacthub/version/${t.kind}/${t.repository}/${t.packageName}`)}function aa(t){return u.post("/catalog/docker/register",t)}function ta(t){return u.post("/catalog/helm/register",t)}function sa(t){return u.post("/catalog/rating/overall",t)}function na(t){return u.get(`/api/applications/integrated/deployment/${t}`)}function oa(t){return u.get(`/catalog/selectbox/options?type=${t}`)}const Ee={class:"modal fade",id:"install-form",tabindex:"-1"},Ae={class:"modal-dialog modal-lg",role:"document"},Ne={class:"modal-content"},Le={class:"modal-header"},Te={class:"modal-title"},$e={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},_e={class:"mb-3"},Pe={key:0,class:"text-muted"},Re={key:1,class:"text-muted"},He=["value"],De={class:"mb-3"},Fe={key:0,class:"text-muted"},Ke={key:1,class:"text-muted"},ze=["value"],Be={value:"selectNsId"},je={class:"mb-3"},qe={key:0,class:"text-muted"},Ye={key:1,class:"text-muted"},Oe=["disabled"],We=["value"],Xe={class:"mb-3"},Ge=["disabled"],Je=["value"],Qe={key:0,class:"mt-2",style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Ze=["onClick"],el={class:"mb-3"},ll={style:{display:"flex",gap:"10px"}},al={class:"form-check"},tl={class:"form-check"},sl={class:"mb-3"},nl=["value"],ol={class:"mb-3"},il={class:"mb-3"},ul={key:0,class:"text-muted"},rl={key:1,class:"text-muted"},cl=["value"],dl={value:"selectNsId"},pl={class:"mb-3"},vl={key:0,class:"text-muted"},ml={key:1,class:"text-muted"},fl=["disabled"],gl=["value"],bl={class:"mb-3"},hl=["value"],yl={key:0,class:"mb-3"},kl={class:"mb-2"},Cl={class:"form-check"},Il={key:0,class:"d-flex justify-content-between"},wl={key:1,class:"mb-3"},Sl={class:"mb-2"},xl={class:"form-check"},Vl={key:0},Ul={class:"mb-2"},Ml={class:"mb-2"},El={class:"mb-2"},Al={class:"mb-2"},Nl={class:"form-check"},Ll={key:0,class:"mb-2"},Tl={class:"modal-footer d-flex justify-content-between"},$l=["disabled"],_l=["disabled"],Pl=fe({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(t){const w=ge(),W=be(),K=t,d=Z(()=>K.title),X=v([]),V=v([]),R=v([]),E=v([]),L=v([]),P=v([]),p=v(""),i=v(""),k=v(""),C=v(""),m=v([]),b=v("Standalone"),f=v({}),c=v({}),H=v([]),A=v(""),S=v(""),D=v(""),N=v(!0);ee(p,async s=>{F.isEmpty(i.value)||(s==="VM"?(k.value="",C.value="",m.value=[],E.value=[],L.value=[],await B()):s==="K8S"&&(A.value="",await j()),S.value="",$())}),ee(b,()=>{b.value==="Standalone"?(m.value=[],E.value=[...L.value]):b.value==="Clustering"&&(m.value=[],E.value=[...L.value])}),he(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await z(),await te()})});const z=async()=>{p.value="VM",i.value="",k.value="",C.value="",m.value=[],L.value=[],b.value="Standalone",f.value={hpaEnabled:!1,hpaMinReplicas:1,hpaMaxReplicas:10,hpaCpuUtilization:60,hpaMemoryUtilization:80},c.value={ingressEnabled:!1,ingressHost:"",ingressPath:"/",ingressClass:"nginx",ingressTlsEnabled:!1,ingressTlsSecret:""},se(),ne(),await oe()},te=async()=>{await Se("").then(({data:s})=>{P.value=s})},se=()=>{X.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},ne=()=>{d.value==="Application Uninstallation"?N.value=!1:N.value=!0},oe=async()=>{await ke().then(async({data:s})=>{if(console.log("## data ### : ",s),V.value=s,V.value.length>0)if(!F.isEmpty(K.nsId))i.value=K.nsId;else if(F.isEmpty(W.getNsId()))i.value=V.value[0].name;else{const e=W.getNsId();V.value.find(y=>y.name===e)?i.value=e:i.value=V.value[0].name}F.isEmpty(i.value)||(p.value==="VM"?await B():p.value==="K8S"&&await j())})},B=async()=>{await Ce(i.value).then(async({data:s})=>{R.value=s,R.value.length>0?(k.value=R.value[0].name,await G()):k.value=""})},G=async()=>{const s={nsId:i.value,mciId:k.value};await Ie(s).then(({data:e})=>{L.value=e.vm,E.value=L.value.filter(l=>!m.value.includes(l.id)),C.value=""})},j=async()=>{await we(i.value).then(({data:s})=>{H.value=s,H.value.length>0?A.value=H.value[0].name:A.value=""})},q=async()=>{m.value=[],await B(),$()},ie=async()=>{m.value=[],await G(),$()},ue=async()=>{await j(),$()},$=()=>{d.value==="Application Installation"?N.value=!0:d.value==="Application Uninstallation"&&(N.value=!1)},re=()=>{if(C.value!==""){if(b.value==="Standalone")m.value=[C.value];else if(b.value==="Clustering"&&!m.value.includes(C.value)){m.value.push(C.value);const s=E.value.findIndex(e=>e.id===C.value);s!==-1&&E.value.splice(s,1)}C.value="",$()}},ce=s=>{const e=m.value[s];if(m.value.splice(s,1),b.value==="Clustering"){const l=L.value.find(y=>y.id===e);l&&E.value.push(l)}$()},de=async()=>{let s={};if(p.value==="VM"){S.value.split(",").map(l=>l.toLowerCase().trim());let e={};if(d.value=="Application Installation"){const l=b.value==="Clustering"?`${S.value}-cluster`:`${S.value}-standalone`;e={namespace:i.value,mciId:k.value,vmIds:m.value,clusterName:l,catalogId:T.value,servicePort:D.value,username:"admin",deploymentType:p.value,vmDeploymentMode:b.value.toUpperCase()},s=await xe(e)}else s=await ae(e);s.data?w.success("SUCCESS"):w.error("FAIL")}else if(p.value==="K8S"){S.value.split(",").map(l=>l.toLowerCase().trim());let e={namespace:i.value,clusterName:A.value,catalogId:T.value,servicePort:D.value,username:"",deploymentType:p.value,hpaEnabled:f.value.hpaEnabled,minReplicas:f.value.hpaMinReplicas,maxReplicas:f.value.hpaMaxReplicas,cpuThreshold:f.value.hpaCpuUtilization,memoryThreshold:f.value.hpaMemoryUtilization,ingressEnabled:c.value.ingressEnabled,ingressHost:c.value.ingressHost,ingressPath:c.value.ingressPath,ingressClass:c.value.ingressClass,ingressTlsEnabled:c.value.ingressTlsEnabled,ingressTlsSecret:c.value.ingressTlsSecret};d.value=="Application Installation"?s=await Ve(e):s=await ae(e),s.data?w.success("SUCCESS"):w.error("FAIL")}},pe=async()=>{p.value==="VM"||p.value==="K8S"?ve().then(s=>{let e=!0;if(s===null){w.error("Please select all items");return}else if(s===!1){let l="";p.value==="VM"?l="VM":p.value==="K8S"&&(l="CLUSTER");const y="Your selected "+l+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(y)}e&&(w.success("Please click RUN"),N.value=!1)}):w.error("Please Select Infra")},ve=async()=>{let s=!1;if(p.value==="VM"){if(i.value===""||k.value===""||m.value.length===0||T.value===0)return null;{const e={namespace:i.value,mciName:k.value,vmName:m.value[0],catalogId:T.value};await Ue(e).then(({data:l})=>{s=l})}}else if(p.value==="K8S"){if(i.value===""||A.value===""||T.value===0){w.error("Please select all items");return}const e={namespace:i.value,clusterName:A.value,catalogId:T.value};await Me(e).then(({data:l})=>{s=l})}return s},T=v(0),J=Z(()=>p.value==="VM"?P.value.filter(s=>s.packageInfo):p.value==="K8S"?P.value.filter(s=>s.helmChart):P.value),Q=()=>{d.value==="Application Installation"&&(N.value=!0),P.value.forEach(s=>{if(S.value===s.name){T.value=s.id;return}})};return(s,e)=>(o(),n("div",Ee,[a("div",Ae,[a("div",Ne,[a("div",Le,[a("h5",Te,g(d.value),1),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:z})]),a("div",$e,[a("div",_e,[e[24]||(e[24]=a("label",{class:"form-label"},"Target Infra",-1)),d.value=="Application Installation"?(o(),n("p",Pe," Select the Infra what is the Infra will be installed ")):d.value=="Application Uninstallation"?(o(),n("p",Re," Select the Infra what is the Infra will be uninstalled ")):h("",!0),r(a("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l)},[(o(!0),n(I,null,U(X.value,l=>(o(),n("option",{value:l.value,key:l.value},g(l.value),9,He))),128))],512),[[x,p.value]])]),p.value=="VM"?(o(),n(I,{key:0},[a("div",De,[e[25]||(e[25]=a("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(o(),n("p",Fe," Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(o(),n("p",Ke," Select the namespace where the application will be uninstalled")):h("",!0),V.value.length>0?r((o(),n("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=l=>i.value=l),onChange:q},[(o(!0),n(I,null,U(V.value,l=>(o(),n("option",{value:l.name,key:l.name},g(l.name),9,ze))),128))],544)),[[x,i.value]]):r((o(),n("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l),onChange:q},[a("option",Be,g(i.value),1)],544)),[[x,i.value]])]),a("div",je,[e[26]||(e[26]=a("label",{class:"form-label"},"MCI Name",-1)),d.value=="Application Installation"?(o(),n("p",qe," Select the multi-cloud infrastructure information where the application will be deployed")):d.value=="Application Uninstallation"?(o(),n("p",Ye," Remove the application and associated resources from the multi-cloud infrastructure")):h("",!0),r(a("select",{class:"form-select",id:"mci-name",disabled:i.value=="","onUpdate:modelValue":e[3]||(e[3]=l=>k.value=l),onChange:ie},[(o(!0),n(I,null,U(R.value,l=>(o(),n("option",{value:l.id,key:l.name},g(l.name),9,We))),128))],40,Oe),[[x,k.value]])]),a("div",Xe,[e[28]||(e[28]=a("label",{class:"form-label"},"VM Name",-1)),e[29]||(e[29]=a("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),r(a("select",{class:"form-select",id:"mci-name",disabled:k.value=="","onUpdate:modelValue":e[4]||(e[4]=l=>C.value=l),onChange:re},[e[27]||(e[27]=a("option",{value:""},"Select VM",-1)),(o(!0),n(I,null,U(E.value,l=>(o(),n("option",{value:l.id,key:l.name},g(l.name),9,Je))),128))],40,Ge),[[x,C.value]]),m.value.length>0?(o(),n("div",Qe,[(o(!0),n(I,null,U(m.value,(l,y)=>(o(),n("label",{key:y,class:"form-check-label",style:{border:"1px solid #000",padding:"5px","border-radius":"5px",cursor:"pointer"}},[O(g(l)+" ",1),a("span",{onClick:_=>ce(y),style:{"margin-left":"5px","font-weight":"bold"}},"X",8,Ze)]))),128))])):h("",!0)]),a("div",el,[e[32]||(e[32]=a("label",{class:"form-label"},"Deployment Type",-1)),e[33]||(e[33]=a("p",{class:"text-muted"},"Select the deployment type",-1)),a("div",ll,[a("div",al,[r(a("input",{class:"form-check-input",type:"radio",id:"Standalone","onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),value:"Standalone"},null,512),[[le,b.value]]),e[30]||(e[30]=a("label",{class:"form-check-label",for:"Standalone"},"Standalone",-1))]),a("div",tl,[r(a("input",{class:"form-check-input",type:"radio",id:"Clustering","onUpdate:modelValue":e[6]||(e[6]=l=>b.value=l),value:"Clustering"},null,512),[[le,b.value]]),e[31]||(e[31]=a("label",{class:"form-check-label",for:"Clustering"},"Clustering",-1))])])]),a("div",sl,[e[34]||(e[34]=a("label",{class:"form-label"},"Application",-1)),e[35]||(e[35]=a("p",{class:"text-muted"},"Select the application",-1)),r(a("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=l=>S.value=l),onChange:Q},[(o(!0),n(I,null,U(J.value,(l,y)=>{var _;return o(),n("option",{key:y,value:l.name}," ["+g(l.name)+"] "+g(((_=l.packageInfo)==null?void 0:_.packageVersion)||"latest"),9,nl)}),128))],544),[[x,S.value]])]),a("div",ol,[e[36]||(e[36]=a("label",{class:"form-label"},"Port",-1)),e[37]||(e[37]=a("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),r(a("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[8]||(e[8]=l=>D.value=l)},null,512),[[M,D.value]])])],64)):p.value=="K8S"?(o(),n(I,{key:1},[a("div",il,[e[38]||(e[38]=a("label",{class:"form-label"},"Namespace",-1)),d.value=="Application Installation"?(o(),n("p",ul,"Select the namespace where the application will be installed")):d.value=="Application Uninstallation"?(o(),n("p",rl,"Select the namespace where the application will be uninstalled")):h("",!0),V.value.length>0?r((o(),n("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[9]||(e[9]=l=>i.value=l),onChange:ue},[(o(!0),n(I,null,U(V.value,l=>(o(),n("option",{value:l.name,key:l.name},g(l.name),9,cl))),128))],544)),[[x,i.value]]):r((o(),n("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[10]||(e[10]=l=>i.value=l),onChange:q},[a("option",dl,g(i.value),1)],544)),[[x,i.value]])]),a("div",pl,[e[39]||(e[39]=a("label",{class:"form-label"},"ClusterName",-1)),d.value=="Application Installation"?(o(),n("p",vl,"Select the name of the cluster where the application will be deployed")):d.value=="Application Uninstallation"?(o(),n("p",ml,"Remove the application and associated resources from the multi-cloud infrastructure")):h("",!0),r(a("select",{class:"form-select",id:"mci-name",disabled:i.value=="","onUpdate:modelValue":e[11]||(e[11]=l=>A.value=l)},[(o(!0),n(I,null,U(H.value,l=>(o(),n("option",{value:l.id,key:l.name},g(l.name),9,gl))),128))],8,fl),[[x,A.value]])]),a("div",bl,[e[40]||(e[40]=a("label",{class:"form-label"},"Helm chart",-1)),e[41]||(e[41]=a("p",{class:"text-muted"},"Select the application",-1)),r(a("select",{class:"form-select","onUpdate:modelValue":e[12]||(e[12]=l=>S.value=l),onChange:Q},[(o(!0),n(I,null,U(J.value,(l,y)=>{var _;return o(),n("option",{key:y,value:l.name}," ["+g(l.name)+"] "+g(((_=l.helmChart)==null?void 0:_.chartVersion)||"latest"),9,hl)}),128))],544),[[x,S.value]])]),d.value=="Application Installation"?(o(),n("div",yl,[e[49]||(e[49]=a("label",{class:"form-label"},"HPA Configuration",-1)),a("div",kl,[a("div",Cl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"hpaEnabled","onUpdate:modelValue":e[13]||(e[13]=l=>f.value.hpaEnabled=l)},null,512),[[Y,f.value.hpaEnabled]]),e[42]||(e[42]=a("label",{class:"form-check-label",for:"hpaEnabled"}," Enable HPA (Horizontal Pod Autoscaler) ",-1))])]),f.value.hpaEnabled?(o(),n("div",Il,[a("div",null,[e[43]||(e[43]=a("label",{class:"form-label required"}," minReplicas ",-1)),r(a("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[14]||(e[14]=l=>f.value.hpaMinReplicas=l)},null,512),[[M,f.value.hpaMinReplicas]])]),a("div",null,[e[44]||(e[44]=a("label",{class:"form-label required"}," maxReplicas ",-1)),r(a("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[15]||(e[15]=l=>f.value.hpaMaxReplicas=l)},null,512),[[M,f.value.hpaMaxReplicas]])]),a("div",null,[e[45]||(e[45]=a("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),r(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[16]||(e[16]=l=>f.value.hpaCpuUtilization=l)},null,512),[[M,f.value.hpaCpuUtilization]]),e[46]||(e[46]=O(" % "))]),a("div",null,[e[47]||(e[47]=a("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),r(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[17]||(e[17]=l=>f.value.hpaMemoryUtilization=l)},null,512),[[M,f.value.hpaMemoryUtilization]]),e[48]||(e[48]=O(" % "))])])):h("",!0)])):h("",!0),d.value=="Application Installation"?(o(),n("div",wl,[e[56]||(e[56]=a("label",{class:"form-label"},"Ingress Configuration",-1)),a("div",Sl,[a("div",xl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"ingressEnabled","onUpdate:modelValue":e[18]||(e[18]=l=>c.value.ingressEnabled=l)},null,512),[[Y,c.value.ingressEnabled]]),e[50]||(e[50]=a("label",{class:"form-check-label",for:"ingressEnabled"}," Enable Ingress ",-1))])]),c.value.ingressEnabled?(o(),n("div",Vl,[a("div",Ul,[e[51]||(e[51]=a("label",{class:"form-label"},"Host",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"example.com","onUpdate:modelValue":e[19]||(e[19]=l=>c.value.ingressHost=l)},null,512),[[M,c.value.ingressHost]])]),a("div",Ml,[e[52]||(e[52]=a("label",{class:"form-label"},"Path",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"/","onUpdate:modelValue":e[20]||(e[20]=l=>c.value.ingressPath=l)},null,512),[[M,c.value.ingressPath]])]),a("div",El,[e[53]||(e[53]=a("label",{class:"form-label"},"Ingress Class",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"nginx","onUpdate:modelValue":e[21]||(e[21]=l=>c.value.ingressClass=l)},null,512),[[M,c.value.ingressClass]])]),a("div",Al,[a("div",Nl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"ingressTlsEnabled","onUpdate:modelValue":e[22]||(e[22]=l=>c.value.ingressTlsEnabled=l)},null,512),[[Y,c.value.ingressTlsEnabled]]),e[54]||(e[54]=a("label",{class:"form-check-label",for:"ingressTlsEnabled"}," Enable TLS ",-1))])]),c.value.ingressTlsEnabled?(o(),n("div",Ll,[e[55]||(e[55]=a("label",{class:"form-label"},"TLS Secret Name",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"tls-secret","onUpdate:modelValue":e[23]||(e[23]=l=>c.value.ingressTlsSecret=l)},null,512),[[M,c.value.ingressTlsSecret]])])):h("",!0)])):h("",!0)])):h("",!0)],64)):h("",!0)]),a("div",Tl,[a("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:z}," Cancel "),a("div",null,[d.value=="Application Installation"?(o(),n("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:pe,disabled:!N.value}," Spec Check ",8,$l)):h("",!0),a("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:de,disabled:N.value}," Deploy ",8,_l)])])])])]))}}),ia=ye(Pl,[["__scopeId","data-v-1b9d9637"]]);export{ia as A,zl as I,na as a,Gl as b,Jl as c,Ol as d,Bl as e,Ql as f,oa as g,Zl as h,Xl as i,ea as j,la as k,Se as l,jl as m,ql as n,aa as o,ta as p,Yl as q,ae as r,sa as s,Wl as u};
